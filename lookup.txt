*[
  _type == "offerPackages" &&
  brandName == "Ama" &&
  identifier == $offerIdentifier &&
  count(participatingDestinations[@->name == $destination]) > 0
] {
  "participatingHotelId": hotels[].participatingHotels[]._ref,
  "DestinationInsideHotelId": participatingDestinations[]->participatingHotels[]._ref
} {
  "commonHotels": [
    // Using array operations to find common hotel IDs
    *[_type == "hotel" && _id in ^.participatingHotelId && _id in ^.DestinationInsideHotelId]._id
  ]
}
--****************

2

*[
  _type == "offerPackages" &&
  brandName == "Ama" &&
  identifier == $offerIdentifier &&
  count(participatingDestinations[@->name == $destination]) > 0
] {
  "commonHotels": array::compact(
    // Return only the hotel IDs that are in both participatingHotelId and DestinationInsideHotelId
    hotels[].participatingHotels[]._ref[ @ in ^.participatingDestinations[]->participatingHotels[]._ref ]
  )
}

